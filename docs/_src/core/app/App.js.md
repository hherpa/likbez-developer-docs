# App.js

## Обзор

Главный компонент приложения, который объединяет все провайдеры и основную логику. Этот компонент отвечает за:
- Инициализацию всех контекстов приложения
- Управление основным UI (Sidebar, диаграмма, редактор)
- Интеграцию всех хуков и компонентов
- Обеспечение работы навигации и редактирования узлов

## Структура компонента

### AppShell
Основной функциональный компонент, который содержит всю логику приложения:
- Интеграцию с ReactFlow для отображения диаграммы
- Sidebar для навигации по файловой системе
- NodeEditor для редактирования узлов
- Все необходимые хуки для управления состоянием

### App
Компонент-обертка, который инициализирует все провайдеры в правильном порядке:
1. ElectronProvider - для интеграции с Electron API
2. AppProvider - для управления тегами категорий
3. FlowProvider - для управления состоянием диаграммы
4. NavigationProvider - для управления навигацией

## Основные функции

### Управление данными
- Автоматическая загрузка и сохранение данных через `useDataPersistence`
- Синхронизация состояния узлов и связей между уровнями
- Управление темой приложения через `useTheme`

### Навигация
- Drag & drop узлов через `useNodeDrop`
- Навигация между уровнями через `useLevelNavigation`
- Навигация к узлам из File Explorer через `useFileExplorerNavigation`

### Редактирование
- Редактор узлов через `useNodeEditor`
- Загрузка изображений через `useImageUpload`
- Сохранение узлов через `useNodeSave`

## Хуки

### Контекстные хуки
- `useFlowContext()` - получение состояния диаграммы
- `useNavigationContext()` - получение состояния навигации
- `useAppContext()` - получение глобального состояния приложения

### Хуки навигации
- `useUI()` - управление UI состоянием (меню, выбранные узлы)
- `useLevelNavigation()` - навигация между уровнями глубины

### Хуки хранения данных
- `useDataPersistence()` - автоматическое сохранение и загрузка данных
- `useTheme()` - управление темой приложения

### Хуки приложения
- `useAppData()` - подготовка данных для редактора
- `useNodeSave()` - сохранение узлов с обновлением всех уровней
- `useFileExplorerNavigation()` - навигация к узлам из File Explorer

## Компоненты

### Основные компоненты
- `Sidebar` - боковая панель для навигации по файловой системе
- `FlowContainer` - контейнер для ReactFlow диаграммы
- `NodeEditor` - редактор узлов с поддержкой markdown

### ReactFlow компоненты
- `ReactFlow` - основной компонент диаграммы
- `MiniMap` - мини-карта для навигации
- `Controls` - элементы управления диаграммой
- `Background` - фон диаграммы с точками

## Состояние

Компонент управляет следующими состояниями:
- `nodes` и `edges` - узлы и связи диаграммы
- `navStack` и `subLevels` - стек навигации и данные уровней
- `categoryTags` - теги категорий
- `darkMode` - тема приложения
- `rfInstance` - инстанс ReactFlow для управления диаграммой

## Эффекты

### Автоматическое сохранение
Сохраняет содержимое текущего уровня в `subLevels` при изменениях узлов или связей.

### Закрытие меню
Автоматически закрывает правое меню при смене текущего уровня.

## Зависимости

Компонент зависит от:
- React и React Hooks
- ReactFlow для диаграмм
- Компонентов из `src/components/`
- Провайдеров из `src/core/providers`
- Хуков из `src/core/hooks`

## Принципы работы

1. **Разделение ответственности** - каждый провайдер отвечает за свою область состояния
2. **Централизованное управление** - все данные проходят через контексты
3. **Автоматическая синхронизация** - состояние диаграммы автоматически синхронизируется с файловой системой
4. **Масштабируемость** - легко добавлять новые функции через хуки и провайдеры