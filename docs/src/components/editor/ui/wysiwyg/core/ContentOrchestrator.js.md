# ContentOrchestrator.js

## Назначение
Оркестратор обновления markdown контента в редакторе, координирующий процесс обновления через специализированные обработчики.

## Экспортируемые компоненты
- `updateContentWithElement` - основная функция обновления контента с элементом

## Структура
1. Импорты утилит, классификаторов и обработчиков
2. Функция `updateContentWithElement` для координации обновления контента

## Взаимодействия
1. Принимает тип элемента, контент, элемент, позицию, оригинальный контент, функцию onChange и contentEditable элемент
2. Логирует параметры вызова
3. Проверяет валидность параметров
4. Разбивает оригинальный контент на строки
5. Находит целевую строку по позиции
6. Делегирует обработку элемента специализированным обработчикам в зависимости от типа элемента
7. Нормализует контент
8. Вызывает onChange с новым контентом

## Зависимости
- `ContentNormalizer.js` - для нормализации контента
- `LineProcessor.js` - для поиска строк по позиции
- `ElementInserter.js` - для построения текста вставки
- `ElementClassifier.js` - для классификации элементов
- `ColorElementHandler.js` - для обработки цветовых элементов
- `SimpleElementHandler.js` - для обработки заголовков и параграфов
- `BlockElementHandler.js` - для обработки блок-элементов
- `InlineLatexHandler.js` - для обработки inline LaTeX
- `Logger.js` - для логирования

## Архитектура
Следует принципу единственной ответственности (SRP), отвечая только за координацию процесса обновления контента. Делегирует работу специализированным модулям.

Функция `updateContentWithElement` реализует логику:
1. Логирует параметры вызова
2. Проверяет валидность параметров (onChange и elementPosition)
3. Разбивает оригинальный контент на строки
4. Находит целевую строку по позиции (с fallback на последнюю строку)
5. Логирует найденную строку
6. Делегирует обработку элемента специализированным обработчикам:
   - `handleColorElement` для цветовых элементов
   - `handleInlineLatex` для inline LaTeX
   - `handleHeaderElement` для заголовков
   - `handleParagraphElement` для параграфов
   - `handleBlockElement` для блок-элементов
7. Нормализует контент с помощью `normalizeContent`
8. Логирует нормализованный контент
9. Вызывает onChange с новым контентом
10. Обрабатывает ошибки с логированием