# ContentUpdater.js

## Назначение
Модуль для обновления контента при потере фокуса в редакторе, отвечающий за обновление исходного контента на основе изменений в элементе.

## Экспортируемые компоненты
- `updateContent` - основная функция обновления контента

## Структура
1. Импорты утилит, классификаторов и обновляторов
2. Функция `updateContent` для обновления контента при blur

## Взаимодействия
1. Принимает новый текст, элемент, позицию элемента, оригинальный контент и функцию onChange
2. Разбивает оригинальный контент на строки
3. Находит целевую строку по позиции
4. Проверяет специальные случаи (параграфы с LaTeX элементами)
5. Обновляет строку в зависимости от типа элемента через специализированные обновляторы
6. Нормализует контент
7. Вызывает onChange с новым контентом

## Зависимости
- `ContentNormalizer.js` - для нормализации контента
- `LineProcessor.js` - для поиска строк по позиции
- `ElementClassifier.js` - для классификации элементов
- `Logger.js` - для логирования
- `HeaderUtils.js` - для обновления заголовков
- `ParagraphUtils.js` - для обновления параграфов
- `ListUpdater.js` - для обновления списков
- `BlockElementUpdater.js` - для обновления block-элементов

## Архитектура
Следует принципу единственной ответственности (SRP), отвечая только за обновление контента при потере фокуса. Использует делегирование специализированным обновляторам для разных типов элементов.

Функция `updateContent` реализует логику:
1. Проверяет валидность параметров (onChange и elementPosition)
2. Разбивает оригинальный контент на строки
3. Находит целевую строку по позиции
4. Для параграфов проверяет наличие LaTeX элементов и защищает их от перезаписи
5. Обновляет строку в зависимости от типа элемента:
   - Заголовки через updateHeaderLine
   - Параграфы через updateParagraphLine
   - Списки через updateListLines
   - HR элементы с нормализацией введенного текста
   - Block-элементы через updateBlockElementLine
   - Остальные элементы напрямую
6. Нормализует контент через normalizeContent
7. Вызывает onChange с новым контентом
8. Обрабатывает ошибки с логированием