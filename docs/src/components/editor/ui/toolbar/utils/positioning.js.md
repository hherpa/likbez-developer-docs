# positioning.js

## Назначение
Утилита для позиционирования плавающего тулбара в редакторе, обеспечивающая расчет позиций и ограничение в пределах viewport.

## Экспортируемые компоненты
- `calculateSelectionPosition` - расчет позиции выделения из textarea
- `calculateSelectionPositionFromContentEditable` - расчет позиции выделения из contentEditable
- `constrainToViewport` - ограничение позиции в пределах viewport

## Структура
1. Singleton элемент для измерения текста
2. Функция `getMeasureElement` для получения/создания элемента измерения
3. Функция `measureTextWidth` для измерения ширины текста
4. Функция `calculateSelectionPosition` для расчета позиции из textarea
5. Функция `calculateSelectionPositionFromContentEditable` для расчета позиции из contentEditable
6. Функция `constrainToViewport` для ограничения позиции в пределах viewport

## Взаимодействия
1. Работает с textarea и contentEditable элементами
2. Использует Selection API для получения выделения
3. Работает с DOM для получения размеров и позиций элементов
4. Использует getComputedStyle для получения стилей элементов
5. Взаимодействует с window для получения размеров viewport

## Зависимости
- Нет внешних зависимостей

## Архитектура
Следует принципу единственной ответственности (SRP), отвечая только за позиционирование тулбара. Использует singleton паттерн для элемента измерения текста.

Функция `calculateSelectionPosition` реализует логику:
1. Проверяет наличие textarea
2. Получает позиции выделения
3. Проверяет наличие выделения
4. Получает выделенный текст
5. Получает размеры и стили textarea
6. Рассчитывает позицию выделения на основе строк и стилей
7. Возвращает координаты центра выделения

Функция `calculateSelectionPositionFromContentEditable` реализует логику:
1. Проверяет наличие элемента
2. Получает выделение из window
3. Проверяет наличие range
4. Проверяет, что выделение не collapsed
5. Получает bounding rectangle выделения
6. Возвращает координаты центра выделения

Функция `constrainToViewport` реализует логику:
1. Проверяет входные параметры
2. Получает размеры viewport
3. Определяет размеры тулбара
4. Ограничивает позицию в пределах viewport с учетом отступов
5. Возвращает скорректированную позицию