# ElementHandler.js

## Назначение
Основной обработчик элементов синтаксиса в тулбаре редактора, координирующий обработку различных типов элементов.

## Экспортируемые компоненты
- `createElementHandler` - основная функция создания обработчика элементов

## Структура
1. Импорты зависимостей и специализированных обработчиков
2. Функция `createElementHandler` для создания обработчика элементов

## Взаимодействия
1. Принимает ref элемента редактирования, элемент, позицию, оригинальный контент и функции обновления
2. Создает замыкание с флагом `isInsertingElement` для предотвращения blur
3. Обрабатывает различные типы элементов через специализированные обработчики
4. Обновляет markdown контент и contentEditable элемент
5. Управляет отображением плавающего тулбара

## Зависимости
- `ElementInserter.js` - для вставки элементов
- `ColorElementHandler.js` - для обработки цветовых элементов
- `LineProcessor.js` - для поиска строк
- `ContentEditableUtils.js` - для работы с contentEditable
- `SelectionUtils.js` - для получения выделенного текста
- `ElementClassifier.js` - для классификации элементов
- `SimpleElementHandler.js` - для обработки простых элементов
- `BlockElementHandler.js` - для обработки блок-элементов
- `InlineLatexHandler.js` - для обработки inline LaTeX
- `ContentNormalizer.js` - для нормализации контента
- `Logger.js` - для логирования

## Архитектура
Следует принципу единственной ответственности (SRP), отвечая только за координацию обработки элементов. Использует стратегию делегирования различным специализированным обработчикам.

Функция `createElementHandler` реализует логику:
1. Создает флаг `isInsertingElement` для предотвращения blur
2. Возвращает функцию обработки элемента
3. Проверяет валидность параметров
4. Получает выделенный текст
5. Определяет тип элемента
6. Обрабатывает цветовые элементы визуально в contentEditable
7. Обрабатывает inline LaTeX в contentEditable
8. Делегирует обработку специализированным обработчикам
9. Нормализует контент
10. Обновляет contentEditable и markdown контент
11. Управляет отображением плавающего тулбара
12. Восстанавливает фокус на элементе редактирования