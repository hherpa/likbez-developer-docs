# BlockElementHandler.js

## Назначение
Обработчик блок-элементов в редакторе, отвечающий за вставку и управление блок-элементами (symbol, latex и др.).

## Экспортируемые компоненты
- `handleBlockElement` - основная функция обработки блок-элементов

## Структура
1. Вспомогательная функция `removeTextWithFallback` для удаления текста с fallback логикой
2. Основная функция `handleBlockElement` для обработки вставки блок-элементов

## Взаимодействия
1. Принимает тип элемента, контент, элемент редактора и информацию о строке
2. Проверяет, обернут ли текст уже в элемент нужного типа
3. Проверяет наличие элемента с таким текстом в документе
4. Удаляет выделенный текст и вставляет элемент

## Зависимости
- `ElementInserter.js` - для вставки элементов
- `TextRemover.js` - для удаления текста
- `ContentSync.js` - для синхронизации markdown с contentEditable
- `ElementDuplicatePreventer.js` - для предотвращения дубликатов
- `Logger.js` - для логирования

## Архитектура
Следует принципу единственной ответственности (SRP), отвечая только за обработку блок-элементов. Использует простую логику:
1. Если текст уже обернут в элемент нужного типа - пропускаем
2. Если элемент уже существует с таким текстом - пропускаем
3. Иначе - удаляем текст и вставляем элемент

Функция `removeTextWithFallback` реализует fallback логику удаления текста:
1. Пробует прямое удаление
2. Если не удалось, пытается найти текст с учетом нормализации
3. Использует регулярные выражения для поиска текста с учетом пробелов