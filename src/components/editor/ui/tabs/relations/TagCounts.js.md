# TagCounts Utility Documentation

## Описание
TagCounts - это утилита для вычисления количества использований тегов в узлах следующего уровня. Функция `computeTagCounts` анализирует узлы следующего уровня и подсчитывает частоту использования каждого тега. Утилита поддерживает два формата хранения тегов: в содержимом узла через специальные маркеры и в отдельном поле данных узла.

## Экспортируемые компоненты
- `computeTagCounts` - основная функция для вычисления количества тегов

## Структура функции
1. **Проверка входных параметров**:
   - Проверка наличия узла и контекста
   - Проверка наличия subLevels в контексте

2. **Определение следующего уровня**:
   - Формирование ключа следующего уровня на основе ID узла
   - Получение данных уровня из контекста

3. **Анализ узлов уровня**:
   - Итерация по всем узлам следующего уровня
   - Извлечение тегов из каждого узла

4. **Подсчет тегов**:
   - Агрегация количества использований каждого тега
   - Возврат объекта с частотами тегов

## Взаимодействия
Функция `computeTagCounts` принимает два параметра:
- `context` - контекст с данными уровней (subLevels)
- `node` - узел, для которого вычисляются теги следующего уровня

Функция взаимодействует с контекстом через:
- `context.subLevels` - данные уровней для анализа
- `level.nodes` - массив узлов следующего уровня

Для каждого узла функция извлекает теги двумя способами:
1. Из содержимого узла через регулярное выражение для поиска паттернов `{.tag}...{.tag}`
2. Из поля `data.tag` узла как резервный способ

## Зависимости
- Нет внешних зависимостей (только стандартный JavaScript)

## Архитектура
Утилита следует паттерну чистой функции, которая принимает данные и возвращает результат без побочных эффектов. Функция инкапсулирует логику извлечения и агрегации тегов. Используется функциональный подход с итерацией по массиву и агрегацией данных. Функция следует принципу единственной ответственности - она только отвечает за подсчет тегов. Поддерживается обратная совместимость с разными форматами хранения тегов. Используется регулярное выражение для извлечения тегов из содержимого узла. Функция экспортируется как именованный экспорт, что позволяет импортировать ее выборочно. Все вычисления выполняются иммутабельно без изменения входных данных. Функция имеет защиту от ошибок через проверку входных параметров. Поддерживается гибкость в формате хранения тегов - как в содержимом узла, так и в отдельном поле данных.